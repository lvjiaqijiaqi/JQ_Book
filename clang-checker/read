clang-checker

下载cmake > cmake version 3.24.3

下载LLVM-project https://github.com/llvm/llvm-project
git clone https://github.com/llvm/llvm-project.git -b  llvmorg-13.0.0

Ninja编译 https://juejin.cn/post/7000886413168214052
mkdir llvm_ninja && cd llvm_ninja
cmake -S ../llvm-project/llvm -B build -G Ninja -DLLVM_ENABLE_PROJECTS="clang" -DCMAKE_INSTALL_PREFIX=xxx

cd build
ninja && ninja install

搭建外部编译环境生成xcode工程

cmake_minimum_required(VERSION 3.19)
project(MYClangCheckerPlugin)
set(CMAKE_OSX_ARCHITECTURES "x86_64")

set(CODE_SIGNING_ALLOWED NO)

# 设置 llvm 依赖
set(CMAKE_PREFIX_PATH ${CMAKE_PREFIX_PATH} "../llvm_release/lib/cmake/llvm" "../llvm_release/lib/cmake/clang")

# 设置 CXX 版本
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${LLVM_COMPILE_FLAGS} -Wall -fno-rtti -std=c++14 -stdlib=libc++ -D__STDC_CONSTANT_MACROS -D__STDC_LIMIT_MACROS")


# 设置 clang和llvm
find_package(LLVM REQUIRED CONFIG)
include_directories(${LLVM_INCLUDE_DIRS})
add_definitions(${LLVM_DEFINITIONS})

find_package(Clang REQUIRED CONFIG)
include_directories(${CLANG_INCLUDE_DIRS})
add_definitions(${Clang_DEFINITIONS})

set(CMAKE_MODULE_LINKER_FLAGS "-Wl,-flat_namespace -Wl,-undefined -Wl,suppress")

# 引入 src 头文件
include_directories(src)

# 添加 Plugin Target
add_library(MYClangCheckerPlugin
  SHARED
  ${PROJECT_SOURCE_DIR}/src/*.cpp
  ${PROJECT_SOURCE_DIR}/src/*.h
)

-analyzer-checker alibaba -analyzer-config alibaba.ios_privacy_violation:privacyOpen=true -analyzer-config alibaba.ios_privacy_violation:privacyConfig=${SRCROOT}/TBToolsClangCheckerTests/Privacy.json




-x c -target x86_64-apple-ios11.0-simulator -fmessage-length\=0 -fdiagnostics-show-note-include-stack -fmacro-backtrace-limit\=0 -std\=gnu11 -fmodules -gmodules -fmodules-cache-path\=/Users/eleme/Library/Developer/Xcode/DerivedData/ModuleCache.noindex -fmodules-prune-interval\=86400 -fmodules-prune-after\=345600 -fbuild-session-file\=/Users/eleme/Library/Developer/Xcode/DerivedData/ModuleCache.noindex/Session.modulevalidation -fmodules-validate-once-per-build-session -Wnon-modular-include-in-framework-module -Werror\=non-modular-include-in-framework-module -fmodule-name\=TBToolsClangCheckerTests -Wno-trigraphs -fpascal-strings -Os -fno-common -Wno-missing-field-initializers -Wno-missing-prototypes -Werror\=return-type -Wdocumentation -Wunreachable-code -Wquoted-include-in-framework-header -Werror\=deprecated-objc-isa-usage -Werror\=objc-root-class -Wno-missing-braces -Wparentheses -Wswitch -Wunused-function -Wno-unused-label -Wno-unused-parameter -Wunused-variable -Wunused-value -Wempty-body -Wuninitialized -Wconditional-uninitialized -Wno-unknown-pragmas -Wno-shadow -Wno-four-char-constants -Wno-conversion -Wconstant-conversion -Wint-conversion -Wbool-conversion -Wenum-conversion -Wno-float-conversion -Wnon-literal-null-conversion -Wobjc-literal-conversion -Wshorten-64-to-32 -Wpointer-sign -Wno-newline-eof -Wno-implicit-fallthrough -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator16.1.sdk -fasm-blocks -fstrict-aliasing -Wdeprecated-declarations -g -Wno-sign-conversion -Winfinite-recursion -Wcomma -Wblock-capture-autoreleasing -Wstrict-prototypes -Wno-semicolon-before-method-body -Wunguarded-availability -D__clang_analyzer__ -Xclang -analyzer-output\=plist-multi-file -Xclang -analyzer-config -Xclang path-diagnostics-alternate\=true -Xclang -analyzer-config -Xclang report-in-main-source-file\=true -Xclang -analyzer-config -Xclang osx.NumberObjectConversion:Pedantic\=true -Xclang -analyzer-checker -Xclang security.insecureAPI.UncheckedReturn -Xclang -analyzer-checker -Xclang security.insecureAPI.getpw -Xclang -analyzer-checker -Xclang security.insecureAPI.gets -Xclang -analyzer-checker -Xclang security.insecureAPI.mkstemp -Xclang -analyzer-checker -Xclang security.insecureAPI.mktemp -Xclang -analyzer-disable-checker -Xclang security.insecureAPI.rand -Xclang -analyzer-disable-checker -Xclang security.insecureAPI.strcpy -Xclang -analyzer-checker -Xclang security.insecureAPI.vfork -Xclang -load -Xclang /Users/eleme/Desktop/Tools/TBToolsClangPlugin/build/Debug/libTBToolsClangPlugin.dylib -Xclang -analyzer-checker -Xclang alibaba -Xclang -analyzer-config -Xclang alibaba.eleme.ios.ban_class_use:banClassConfigure\=/Users/eleme/Desktop/Tools/TBToolsClangPlugin/test/banClass.json -Xclang -DNS_FORMAT_ARGUMENT\(A\)\= -Xclang -D_Nullable_result\=_Nullable -iquote /Users/eleme/Library/Developer/Xcode/DerivedData/TBToolsClangCheckerTests-bjtpfyyxprfzsshaxsxqjqzntanz/Build/Intermediates.noindex/TBToolsClangCheckerTests.build/Release-iphonesimulator/TBToolsClangCheckerTests.build/TBToolsClangCheckerTests-generated-files.hmap -I/Users/eleme/Library/Developer/Xcode/DerivedData/TBToolsClangCheckerTests-bjtpfyyxprfzsshaxsxqjqzntanz/Build/Intermediates.noindex/TBToolsClangCheckerTests.build/Release-iphonesimulator/TBToolsClangCheckerTests.build/TBToolsClangCheckerTests-own-target-headers.hmap -I/Users/eleme/Library/Developer/Xcode/DerivedData/TBToolsClangCheckerTests-bjtpfyyxprfzsshaxsxqjqzntanz/Build/Intermediates.noindex/TBToolsClangCheckerTests.build/Release-iphonesimulator/TBToolsClangCheckerTests.build/TBToolsClangCheckerTests-all-non-framework-target-headers.hmap -ivfsoverlay /Users/eleme/Library/Developer/Xcode/DerivedData/TBToolsClangCheckerTests-bjtpfyyxprfzsshaxsxqjqzntanz/Build/Intermediates.noindex/TBToolsClangCheckerTests.build/Release-iphonesimulator/TBToolsClangCheckerTests.build/all-product-headers.yaml -iquote /Users/eleme/Library/Developer/Xcode/DerivedData/TBToolsClangCheckerTests-bjtpfyyxprfzsshaxsxqjqzntanz/Build/Intermediates.noindex/TBToolsClangCheckerTests.build/Release-iphonesimulator/TBToolsClangCheckerTests.build/TBToolsClangCheckerTests-project-headers.hmap -I/Users/eleme/Library/Developer/Xcode/DerivedData/TBToolsClangCheckerTests-bjtpfyyxprfzsshaxsxqjqzntanz/Build/Products/Release-iphonesimulator/include -I/Users/eleme/Library/Developer/Xcode/DerivedData/TBToolsClangCheckerTests-bjtpfyyxprfzsshaxsxqjqzntanz/Build/Intermediates.noindex/TBToolsClangCheckerTests.build/Release-iphonesimulator/TBToolsClangCheckerTests.build/DerivedSources-normal/x86_64 -I/Users/eleme/Library/Developer/Xcode/DerivedData/TBToolsClangCheckerTests-bjtpfyyxprfzsshaxsxqjqzntanz/Build/Intermediates.noindex/TBToolsClangCheckerTests.build/Release-iphonesimulator/TBToolsClangCheckerTests.build/DerivedSources/x86_64 -I/Users/eleme/Library/Developer/Xcode/DerivedData/TBToolsClangCheckerTests-bjtpfyyxprfzsshaxsxqjqzntanz/Build/Intermediates.noindex/TBToolsClangCheckerTests.build/Release-iphonesimulator/TBToolsClangCheckerTests.build/DerivedSources -F/Users/eleme/Library/Developer/Xcode/DerivedData/TBToolsClangCheckerTests-bjtpfyyxprfzsshaxsxqjqzntanz/Build/Products/Release-iphonesimulator -MMD -MT dependencies -MF /Users/eleme/Library/Developer/Xcode/DerivedData/TBToolsClangCheckerTests-bjtpfyyxprfzsshaxsxqjqzntanz/Build/Intermediates.noindex/TBToolsClangCheckerTests.build/Release-iphonesimulator/TBToolsClangCheckerTests.build/StaticAnalyzer/TBToolsClangCheckerTests/TBToolsClangCheckerTests/normal/x86_64/TBToolsClangCheckerTests_vers.d --analyze /Users/eleme/Library/Developer/Xcode/DerivedData/TBToolsClangCheckerTests-bjtpfyyxprfzsshaxsxqjqzntanz/Build/Intermediates.noindex/TBToolsClangCheckerTests.build/Release-iphonesimulator/TBToolsClangCheckerTests.build/DerivedSources/TBToolsClangCheckerTests_vers.c -o /Users/eleme/Library/Developer/Xcode/DerivedData/TBToolsClangCheckerTests-bjtpfyyxprfzsshaxsxqjqzntanz/Build/Intermediates.noindex/TBToolsClangCheckerTests.build/Release-iphonesimulator/TBToolsClangCheckerTests.build/StaticAnalyzer/TBToolsClangCheckerTests/TBToolsClangCheckerTests/normal/x86_64/TBToolsClangCheckerTests_vers.plist



